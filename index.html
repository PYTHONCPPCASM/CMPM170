<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>crisp-game-lib</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height,
    user-scalable=no, initial-scale=1, maximum-scale=1"
    />
    <script src="https://unpkg.com/sounds-some-sounds@1.0.5/build/index.js"></script>
    <script src="https://unpkg.com/gif-capture-canvas@1.1.0/build/index.js"></script>
    <script src="https://unpkg.com/terser@4.6.11/dist/bundle.min.js"></script>
    <script src="https://unpkg.com/pixi.js@5.3.0/dist/pixi.min.js"></script>
    <script src="https://unpkg.com/pixi-filters@3.1.1/dist/pixi-filters.js"></script>
    <script>
      var module = {};
    </script>
    <script src="https://unpkg.com/lodash.clonedeep@4.5.0/index.js"></script>
    <script src="https://abagames.github.io/crisp-game-lib/bundle.js"></script>

<script>
title = "Osu2.0";

description = `
  Click On Circles.
`;

characters = [
`
 rrr
rrrrr
rrrrr
 rrr
`
];

let player;

  const G = {
    WIDTH: 150,
    HEIGHT: 150,

    STAR_SPEED_MIN: 0.5,
    STAR_SPEED_MAX: 1.0,

    PLAYER_FIRE_RATE: 4,
    PLAYER_GUN_OFFSET: 3,
    FBULLET_SPEED: 5,
    
    ENEMY_MIN_BASE_SPEED: 1.0,
    ENEMY_MAX_BASE_SPEED: 2.0,
    ENEMY_FIRE_RATE: 45,

    EBULLET_SPEED: 2.0,
    EBULLET_ROTATION_SPD: 0.1,

    SPINNING : 10,

    // Game Text settings
    MULTIPLIER : 1,
    LIFELINE: 100,

    //timer for circle
    TIMER: 150
  };

options = {
  viewSize: {x: G.WIDTH, y: G.HEIGHT},
  seed : 1337,
  isPlayingBgm: true,
  isReplayEnabled: true,
  theme: "dark"
};

  let list;
  list = [];
  let strips;
  strips = [];

  player = {
    pos: vec(G.WIDTH / 2, G.HEIGHT / 2),
    health: G.LIFELINE
  }

  let healthText;
  let timer = G.TIMER;
  let timer2 = 200;
  let thickness = 10;
  let size = 10;
  let direction = 1;

function update() {
  if (!ticks) {
    SPEED = 1;
    energy = 10;
    missed = 0;

    strips = times(20, ()=>{
      const posX = rnd(0, G.WIDTH);
      const posY = rnd(0, G.HEIGHT);
        return{
          pos: vec(posX, posY),
          speed: rnd(0.5, 1.0)
        };
    });
  }

  // Game Text
  color("red");
  let multiX = text("x" + G.MULTIPLIER.toString(), 3, 10);
  healthText = player.health.toString();
  if (player.health < 100) {
    healthText = healthText.slice(0, (healthText.indexOf(".")) + 2);
  }
  let healthB = text(healthText + "%", 120, 10);

  // Updating and drawing the player
  player.pos = vec(input.pos.x, input.pos.y);
  player.pos.clamp(0, G.WIDTH, 0, G.HEIGHT);
  char("a", player.pos);

  // Health maintenance
  if (player.health >= 100) {
    player.health = 100;
  } else if (player.health > 0 && player.health < 100) {
    player.health += 0.1;
  } else {
    end();
    player.health = 100;
  }

  // constantly filling the list
  if(list.length === 0){
    for(let i = 0; i < 1; i++){
      const posX = rnd(20, 80);
      const posY = rnd(20, 80);
      list.push({pos: vec(posX, posY)});
    }
  }

  strips.forEach((s)=>{
    box(s.pos, 1);
    s.pos.x -= s.speed;
    s.pos.wrap(0, G.WIDTH, 0, G.HEIGHT);
    color("yellow");
  });

  if(input.isJustPressed){
      direction *= -1;
  }

  // Remove circles 1 from left to right
  remove(list, (l) => {

    color("purple");
    
    thickness -= 0.16;
    size -= 0.16;
    arc(l.pos.x, l.pos.y, size, thickness, 180);
    
    //transformation of circle in random movement
    
    

    l.pos.x += Math.sin(thickness / 20) / 10;
    l.pos.x += 1 * direction;

    
    
    particle(player.pos);
    // Player circle click
    if ((char("a", player.pos).isColliding.rect.purple) && input.isJustPressed){
      energy++;
      play("jump");
      addScore(10 * G.MULTIPLIER, l.pos);
      G.MULTIPLIER += 1;
      thickness = 10;
      size = 10;
    }

    // Reset score multiplier
    if (input.isJustPressed && !((char("a", player.pos).isColliding.rect.purple))) {
      
      G.MULTIPLIER = 1;
      if (player.health < 25) {
        player.health = 0;
      } else {
        player.health -= 25;
      }

    }
    
    if (l.pos.y > G.HEIGHT || l.pos.x > G.WIDTH) {
      missed += 1;
      play("powerUp");
    }

    if(thickness < -1 || size < -1){
      thickness = 10;
      size = 10;
    }
    //if disappear and you did not click
    if(thickness < 0 || size < 0 || l.pos.x > G.WIDTH && !input.isPressed){
      missed += 1;
      console.log("missed = " + missed);
    }

    return (char("a", player.pos).isColliding.rect.purple && input.isJustPressed) || thickness < 0 || size < 0 || l.pos.x > G.WIDTH || l.pos.x < 0;
  });


}

addEventListener("load", onLoad);
</script>

  </head>
  <body style="background: #ddd"></body>
</html>